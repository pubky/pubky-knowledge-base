<!DOCTYPE html>
<html lang="en"><head><title>Homegate | Pubky Core</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter Tight&amp;family=Inter Tight:wght@400;700&amp;family=Inter Tight:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Homegate"/><meta property="og:description" content="Homegate: Homeserver Signup Gatekeeping Service Homegate is a backend service that manages and controls signups for Pubky Homeservers. It provides verification mechanisms to prevent spam and abuse while preserving user privacy, implementing both SMS verification and Lightning Network payment verification for homeserver access."/><meta property="og:image" content="https://docs.pubky.org/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../../static/favicon.svg"/><meta name="description" content="Homegate: Homeserver Signup Gatekeeping Service Homegate is a backend service that manages and controls signups for Pubky Homeservers. It provides verification mechanisms to prevent spam and abuse while preserving user privacy, implementing both SMS verification and Lightning Network payment verification for homeserver access."/><meta name="generator" content="Quartz"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Explore/Technologies/Homegate"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><a href="/"><img style="margin:0px;" src="/static/pubky-core-logo.webp" width="209" height="44"/></a><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="title">Search</title><desc id="desc">Search</desc><path opacity="0.2" d="M9.06213 15.625C12.6865 15.625 15.6246 12.6869 15.6246 9.0625C15.6246 5.43813 12.6865 2.5 9.06213 2.5C5.43777 2.5 2.49963 5.43813 2.49963 9.0625C2.49963 12.6869 5.43777 15.625 9.06213 15.625Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.06213 3.125C5.78294 3.125 3.12463 5.78331 3.12463 9.0625C3.12463 12.3417 5.78294 15 9.06213 15C12.3413 15 14.9996 12.3417 14.9996 9.0625C14.9996 5.78331 12.3413 3.125 9.06213 3.125ZM1.87463 9.0625C1.87463 5.09295 5.09259 1.875 9.06213 1.875C13.0317 1.875 16.2496 5.09295 16.2496 9.0625C16.2496 13.032 13.0317 16.25 9.06213 16.25C5.09259 16.25 1.87463 13.032 1.87463 9.0625Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2603 13.2612C13.5044 13.0171 13.9001 13.0171 14.1442 13.2612L17.9411 17.0581C18.1852 17.3022 18.1852 17.6979 17.9411 17.942C17.6971 18.1861 17.3013 18.1861 17.0572 17.942L13.2603 14.1451C13.0163 13.901 13.0163 13.5053 13.2603 13.2612Z" fill="white"></path></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="explorer desktop-only"><div type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;Explore&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;Explore/Concepts&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyApp&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyApp/AppArchitectures&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyApp/Backend&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyApp/Client&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyApp/Client/Features&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyCore&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/PubkyCore/Pkarr&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Explore/Technologies&quot;,&quot;collapsed&quot;:true}]"></div><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li style="margin-bottom:10px;"><a href="../../Architecture" data-for="Architecture">Architecture</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Comparisons" data-for="Comparisons">Comparisons</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Contributing" data-for="Contributing">Contributing</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore"><button class="folder-button"><span class="folder-title">Explore</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore"><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/Concepts"><button class="folder-button"><span class="folder-title">Concepts</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/Concepts"><li style="margin-bottom:10px;"><a href="../../Explore/Concepts/Censorship" data-for="Explore/Concepts/Censorship">Censorship</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Concepts/CredibleExit" data-for="Explore/Concepts/CredibleExit">Credible Exit</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Concepts/SemanticSocialGraph" data-for="Explore/Concepts/SemanticSocialGraph">Semantic Social Graph</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyApp"><button class="folder-button"><span class="folder-title">Pubky App</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyApp"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Introduction" data-for="Explore/PubkyApp/Introduction">Introduction</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/ELI5" data-for="Explore/PubkyApp/ELI5">ELI5</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyApp/AppArchitectures"><button class="folder-button"><span class="folder-title">App Architectures</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyApp/AppArchitectures"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/AppArchitectures/1.Introduction" data-for="Explore/PubkyApp/AppArchitectures/1.Introduction">Introduction</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/AppArchitectures/2.ClientHomeserver" data-for="Explore/PubkyApp/AppArchitectures/2.ClientHomeserver">Client - Homeserver</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/AppArchitectures/3.GlobalAggregators" data-for="Explore/PubkyApp/AppArchitectures/3.GlobalAggregators">Global Aggregators</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/AppArchitectures/4.CustomBackend" data-for="Explore/PubkyApp/AppArchitectures/4.CustomBackend">Custom Backend</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyApp/Backend"><button class="folder-button"><span class="folder-title">Backend</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyApp/Backend"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Backend/Introduction" data-for="Explore/PubkyApp/Backend/Introduction">Introduction</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Backend/Aggregator" data-for="Explore/PubkyApp/Backend/Aggregator">Aggregator</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Backend/Indexer" data-for="Explore/PubkyApp/Backend/Indexer">Indexer</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Backend/PubkyNexus" data-for="Explore/PubkyApp/Backend/PubkyNexus">Pubky Nexus</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Backend/WebServer" data-for="Explore/PubkyApp/Backend/WebServer">Web Server</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyApp/Client"><button class="folder-button"><span class="folder-title">Client</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyApp/Client"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Introduction" data-for="Explore/PubkyApp/Client/Introduction">Introduction</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyApp/Client/Features"><button class="folder-button"><span class="folder-title">Features</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyApp/Client/Features"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Bookmarks" data-for="Explore/PubkyApp/Client/Features/Bookmarks">Bookmarks</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Layouts" data-for="Explore/PubkyApp/Client/Features/Layouts">Layouts</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Notifications" data-for="Explore/PubkyApp/Client/Features/Notifications">Notifications</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Perspectives" data-for="Explore/PubkyApp/Client/Features/Perspectives">Perspectives</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Posts" data-for="Explore/PubkyApp/Client/Features/Posts">Posts</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Profiles" data-for="Explore/PubkyApp/Client/Features/Profiles">Profiles</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Search" data-for="Explore/PubkyApp/Client/Features/Search">Search</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Tags" data-for="Explore/PubkyApp/Client/Features/Tags">Tags</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyApp/Client/Features/Trends" data-for="Explore/PubkyApp/Client/Features/Trends">Trends</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li></ul></div></li></ul></div></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyCore"><button class="folder-button"><span class="folder-title">Pubky Core</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyCore"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Introduction" data-for="Explore/PubkyCore/Introduction">Introduction</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/ELI5" data-for="Explore/PubkyCore/ELI5">ELI5</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/API" data-for="Explore/PubkyCore/API">API</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Authentication" data-for="Explore/PubkyCore/Authentication">Authentication</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Homeserver" data-for="Explore/PubkyCore/Homeserver">Homeserver</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/PubkyCore/Pkarr"><button class="folder-button"><span class="folder-title">Pkarr</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/PubkyCore/Pkarr"><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Pkarr/ELI5" data-for="Explore/PubkyCore/Pkarr/ELI5">ELI5</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Pkarr/0.Introduction" data-for="Explore/PubkyCore/Pkarr/0.Introduction">0.Introduction</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Pkarr/1.WhyPkarr" data-for="Explore/PubkyCore/Pkarr/1.WhyPkarr">Why Pkarr?</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Pkarr/2.GettingStartedWithPkarr" data-for="Explore/PubkyCore/Pkarr/2.GettingStartedWithPkarr">Getting Started with Pkarr</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Pkarr/3.Expectations" data-for="Explore/PubkyCore/Pkarr/3.Expectations">3.Expectations</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/Pkarr/4.Architecture" data-for="Explore/PubkyCore/Pkarr/4.Architecture">4.Architecture</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li><li style="margin-bottom:10px;"><a href="../../Explore/PubkyCore/SDK" data-for="Explore/PubkyCore/SDK">SDK</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li><li><div style="margin-bottom:10px;" class="folder-container"><div data-folderpath="Explore/Technologies"><button class="folder-button"><span class="folder-title">Technologies</span></button></div><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Explore/Technologies"><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/DHT" data-for="Explore/Technologies/DHT">DHT</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/DNS" data-for="Explore/Technologies/DNS">DNS</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/DoH" data-for="Explore/Technologies/DoH">DoH</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/Homegate" data-for="Explore/Technologies/Homegate">Homegate</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/HTTPS" data-for="Explore/Technologies/HTTPS">HTTPS</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/JebPubkyAIBot" data-for="Explore/Technologies/JebPubkyAIBot">Jeb: Pubky AI Bot</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/KeyPair" data-for="Explore/Technologies/KeyPair">Key Pair</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/MainlineDHT" data-for="Explore/Technologies/MainlineDHT">Mainline DHT</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/Paykit" data-for="Explore/Technologies/Paykit">Paykit</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/PKDNS" data-for="Explore/Technologies/PKDNS">PKDNS</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/PubkyCLI" data-for="Explore/Technologies/PubkyCLI">Pubky CLI</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/PubkyDocker" data-for="Explore/Technologies/PubkyDocker">Pubky Docker</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/PubkyExplorer" data-for="Explore/Technologies/PubkyExplorer">Pubky Explorer</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/PubkyNoise" data-for="Explore/Technologies/PubkyNoise">Pubky Noise</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Explore/Technologies/PubkyRing" data-for="Explore/Technologies/PubkyRing">Pubky Ring</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li></ul></div></li><li style="margin-bottom:10px;"><a href="../../FAQ" data-for="FAQ">FAQ</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../GettingStarted" data-for="GettingStarted">Getting Started</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Glossary" data-for="Glossary">Glossary</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><div style="border:none;border-top:0.1px solid white;opacity:0.2;margin-top:10px;margin-bottom:30px;"></div><li style="margin-bottom:10px;"><a href="../../Readme" data-for="Readme">Readme</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../TheVisionOfPubky" data-for="TheVisionOfPubky">The Vision of Pubky</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../TLDR" data-for="TLDR">TLDR</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li><li style="margin-bottom:10px;"><a href="../../Troubleshooting" data-for="Troubleshooting">Troubleshooting</a><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="grey" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon-fixed"><polyline points="6 9 12 15 18 9"></polyline></svg></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../Explore/">Explore</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../Explore/Technologies/">Technologies</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Homegate</a></div></nav><h1 class="article-title">Homegate</h1><p show-comma="true" class="content-meta"><span>Feb 13, 2026</span><span>10 min read</span></p></div></div><article class="popover-hint"><h1 id="homegate-homeserver-signup-gatekeeping-service">Homegate: Homeserver Signup Gatekeeping Service<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#homegate-homeserver-signup-gatekeeping-service" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p><strong>Homegate</strong> is a backend service that manages and controls signups for <a href="../../Explore/PubkyCore/Homeserver" class="internal alias" data-slug="Explore/PubkyCore/Homeserver">Pubky Homeservers</a>. It provides verification mechanisms to prevent spam and abuse while preserving user privacy, implementing both SMS verification and Lightning Network payment verification for homeserver access.</p>
<h2 id="overview">Overview<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#overview" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>When operating a public homeserver, spam prevention is critical. Homegate acts as a gatekeeper, requiring users to prove their authenticity before gaining access to create accounts on a homeserver. Unlike traditional centralized signup systems, Homegate is designed to:</p>
<ul>
<li><strong>Prevent spam</strong>: Rate-limit signups per phone number or require economic commitment via Lightning payments</li>
<li><strong>Preserve privacy</strong>: Use cryptographic hashing (Argon2id with Blake3 pepper) to protect phone number privacy</li>
<li><strong>Remain optional</strong>: Homeserver operators can choose to use Homegate, implement their own solution, or allow open signups</li>
<li><strong>Support multiple verification methods</strong>: SMS codes or Lightning Network payments</li>
</ul>
<h3 id="use-case">Use Case<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#use-case" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Homegate solves the problem expressed in <a href="../../FAQ#q37" class="internal alias" data-slug="FAQ">Q37</a>: “How do users join Pubky App? Via invite codes from homeservers. Prevents spam while preserving privacy.”</p>
<p>While the FAQ mentions “invite codes,” Homegate implements a more sophisticated system using:</p>
<ol>
<li><strong>SMS verification</strong>: Send a code to a phone number, verify ownership</li>
<li><strong>Lightning payment verification</strong>: Generate a BOLT11 invoice, verify payment</li>
</ol>
<h2 id="architecture">Architecture<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#architecture" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="components">Components<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#components" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>HTTP API Server</strong> (<code>axum</code>):</p>
<ul>
<li>RESTful endpoints for verification flows</li>
<li>OpenAPI specification for API documentation</li>
<li>CORS support for browser-based clients</li>
<li>Request origin tracking for abuse prevention</li>
</ul>
<p><strong>SMS Verification Service</strong>:</p>
<ul>
<li>Integration with <a href="https://docs.prelude.so/" class="external">Prelude<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> SMS provider</li>
<li>Rate limiting per phone number (weekly/annual limits)</li>
<li>Cryptographic phone number hashing for privacy</li>
<li>Session reuse for pending verifications</li>
</ul>
<p><strong>Lightning Network Verification Service</strong>:</p>
<ul>
<li>Integration with <a href="https://github.com/ACINQ/phoenixd" class="external">PhoenixD<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> Lightning node</li>
<li>BOLT11 invoice generation</li>
<li>Real-time payment tracking via WebSocket</li>
<li>Background payment synchronization</li>
</ul>
<p><strong>Database Layer</strong> (PostgreSQL + SQLx):</p>
<ul>
<li>Verification request tracking</li>
<li>Rate limit enforcement</li>
<li>Payment status management</li>
<li>Migration system for schema evolution</li>
</ul>
<p><strong>Security Layer</strong>:</p>
<ul>
<li>Argon2id password hashing for phone numbers</li>
<li>Blake3-based pepper stored securely on disk</li>
<li>Per-IP rate limiting</li>
<li>User-agent tracking</li>
</ul>
<h3 id="technology-stack">Technology Stack<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#technology-stack" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>Language</strong>: Rust</li>
<li><strong>Web Framework</strong>: Axum 0.8</li>
<li><strong>Database</strong>: PostgreSQL via SQLx</li>
<li><strong>SMS Provider</strong>: Prelude API</li>
<li><strong>Lightning</strong>: PhoenixD via HTTP + WebSocket APIs</li>
<li><strong>Cryptography</strong>: Argon2id (hashing), Blake3 (pepper)</li>
</ul>
<h2 id="verification-methods">Verification Methods<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#verification-methods" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="sms-verification">SMS Verification<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#sms-verification" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Users verify phone number ownership by receiving and entering a verification code.</p>
<h4 id="flow">Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>
<p><strong>Request Code</strong>: <code>POST /sms_verification/send_code</code></p>
<ul>
<li>Submit phone number in E.164 format (e.g., <code>+30123456789</code>)</li>
<li>Service checks rate limits (default: 2/week, 4/year per number)</li>
<li>Creates Prelude verification session</li>
<li>Sends SMS code to phone number</li>
</ul>
</li>
<li>
<p><strong>Verify Code</strong>: <code>POST /sms_verification/verify_code</code></p>
<ul>
<li>Submit phone number and 6-digit code</li>
<li>Service validates code with Prelude</li>
<li>Returns success/failure</li>
</ul>
</li>
<li>
<p><strong>Get Status</strong>: <code>GET /sms_verification/status/{phone_number}</code></p>
<ul>
<li>Check if phone number is verified</li>
<li>Returns verification state</li>
</ul>
</li>
</ol>
<h4 id="rate-limits">Rate Limits<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#rate-limits" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Configurable per homeserver deployment:</p>
<ul>
<li><strong>Weekly limit</strong>: <code>HG_MAX_SMS_VERIFICATIONS_PER_WEEK</code> (default: 2)</li>
<li><strong>Annual limit</strong>: <code>HG_MAX_SMS_VERIFICATIONS_PER_YEAR</code> (default: 4)</li>
</ul>
<p>These limits prevent:</p>
<ul>
<li>Phone number farming</li>
<li>Bulk account creation</li>
<li>Verification code abuse</li>
</ul>
<h4 id="privacy-protection">Privacy Protection<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#privacy-protection" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Phone numbers are <strong>never stored in plaintext</strong>:</p>
<ol>
<li><strong>Blake3 Pepper</strong>: Secret value generated on first run, stored at <code>/.homegate/pepper.txt</code></li>
<li><strong>Argon2id Hashing</strong>: Phone number + pepper → cryptographic hash</li>
<li><strong>Database Storage</strong>: Only hash is stored, not original phone number</li>
</ol>
<p><strong>⚠️ Critical</strong>: If <code>pepper.txt</code> is lost, existing verifications cannot be matched to new requests, breaking rate limit enforcement.</p>
<h4 id="session-reuse">Session Reuse<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#session-reuse" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Multiple <code>send_code</code> requests for the same phone number reuse the existing Prelude session:</p>
<ul>
<li>Prevents SMS flooding</li>
<li>Reduces costs for homeserver operators</li>
<li>User can request code resend without creating new session</li>
</ul>
<h3 id="lightning-network-verification">Lightning Network Verification<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lightning-network-verification" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Users verify economic commitment by paying a Lightning Network invoice.</p>
<h4 id="flow-1">Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#flow-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>
<p><strong>Create Verification</strong>: <code>POST /ln_verification</code></p>
<ul>
<li>Optional amount and description</li>
<li>Service generates BOLT11 invoice via PhoenixD</li>
<li>Returns verification ID and invoice string</li>
</ul>
</li>
<li>
<p><strong>Check Status</strong>: <code>GET /ln_verification/{verification_id}</code></p>
<ul>
<li>Check current payment status</li>
<li>Returns: <code>pending</code>, <code>paid</code>, <code>expired</code>, or <code>failed</code></li>
</ul>
</li>
<li>
<p><strong>Await Payment</strong>: <code>GET /ln_verification/{verification_id}/await</code></p>
<ul>
<li>Long-polling endpoint (30s timeout)</li>
<li>Waits for payment confirmation</li>
<li>Returns immediately if already paid</li>
</ul>
</li>
<li>
<p><strong>Background Sync</strong>: Continuous WebSocket connection to PhoenixD</p>
<ul>
<li>Monitors all incoming payments in real-time</li>
<li>Updates verification status automatically</li>
<li>Handles reconnections and error recovery</li>
</ul>
</li>
</ol>
<h4 id="payment-amounts">Payment Amounts<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#payment-amounts" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Configurable by homeserver operator:</p>
<ul>
<li><strong>Minimum amount</strong>: Prevent dust attacks</li>
<li><strong>Default amount</strong>: Balance between accessibility and spam prevention</li>
<li><strong>Custom amounts</strong>: Allow users to pay more for priority, donations, etc.</li>
</ul>
<h4 id="economic-anti-spam">Economic Anti-Spam<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#economic-anti-spam" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Lightning payments provide natural spam resistance:</p>
<ul>
<li><strong>Cost per signup</strong>: Makes bulk account creation expensive</li>
<li><strong>Instant verification</strong>: No waiting for confirmations</li>
<li><strong>Privacy-preserving</strong>: No personal information required</li>
<li><strong>Censorship-resistant</strong>: Lightning Network is permissionless</li>
</ul>
<h2 id="api-reference">API Reference<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#api-reference" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="sms-verification-endpoints">SMS Verification Endpoints<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#sms-verification-endpoints" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="send-verification-code">Send Verification Code<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#send-verification-code" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="http" data-theme="github-light github-dark"><code data-language="http" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /sms_verification/send_code</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application/json</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;phoneNumber&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;+30123456789&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Responses</strong>:</p>
<ul>
<li><code>200 OK</code>: Code sent successfully</li>
<li><code>400 Bad Request</code>: Invalid phone number format</li>
<li><code>429 Too Many Requests</code>: Rate limit exceeded</li>
<li><code>500 Internal Server Error</code>: SMS service failure</li>
</ul>
<h4 id="verify-code">Verify Code<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#verify-code" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="http" data-theme="github-light github-dark"><code data-language="http" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /sms_verification/verify_code</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application/json</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;phoneNumber&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;+30123456789&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Responses</strong>:</p>
<ul>
<li><code>200 OK</code>: Code verified successfully</li>
<li><code>400 Bad Request</code>: Invalid code</li>
<li><code>404 Not Found</code>: No pending verification</li>
<li><code>410 Gone</code>: Verification expired</li>
</ul>
<h4 id="get-status">Get Status<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#get-status" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="http" data-theme="github-light github-dark"><code data-language="http" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /sms_verification/status/{phoneNumber}</span></span></code></pre></figure>
<p><strong>Responses</strong>:</p>
<ul>
<li><code>200 OK</code>: Returns JSON with verification status</li>
<li><code>404 Not Found</code>: Phone number not verified</li>
</ul>
<h3 id="lightning-network-endpoints">Lightning Network Endpoints<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lightning-network-endpoints" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="create-verification">Create Verification<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#create-verification" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="http" data-theme="github-light github-dark"><code data-language="http" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /ln_verification</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application/json</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;amountSat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Homeserver signup verification&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Response</strong> (200 OK):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="json" data-theme="github-light github-dark"><code data-language="json" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;verificationId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;invoice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lnbc10n1...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;amountSat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expiresAt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-01-05T12:00:00Z&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<h4 id="get-verification-status">Get Verification Status<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#get-verification-status" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="http" data-theme="github-light github-dark"><code data-language="http" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /ln_verification/{verificationId}</span></span></code></pre></figure>
<p><strong>Response</strong> (200 OK):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="json" data-theme="github-light github-dark"><code data-language="json" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;verificationId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;paid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;amountSat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;paidAt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-01-05T11:30:00Z&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Status values</strong>: <code>pending</code>, <code>paid</code>, <code>expired</code>, <code>failed</code></p>
<h4 id="await-payment">Await Payment<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#await-payment" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="http" data-theme="github-light github-dark"><code data-language="http" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /ln_verification/{verificationId}/await</span></span></code></pre></figure>
<p>Long-polling endpoint that waits up to 30 seconds for payment:</p>
<ul>
<li>Returns immediately if already paid</li>
<li>Times out after 30s if still pending</li>
<li>Client should retry if timeout occurs</li>
</ul>
<h2 id="deployment">Deployment<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#deployment" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="prerequisites">Prerequisites<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#prerequisites" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li>PostgreSQL database</li>
<li>Prelude API account (for SMS)</li>
<li>PhoenixD Lightning node (for Lightning payments)</li>
<li>Rust toolchain (for building from source)</li>
</ul>
<h3 id="configuration">Configuration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#configuration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Set environment variables (see <code>.env.example</code> in repository):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Database</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATABASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres://user:pass@localhost:5432/homegate</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Prelude SMS</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PRELUDE_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_prelude_api_key</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PRELUDE_PROJECT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_project_id</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PhoenixD Lightning</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PHOENIXD_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:9740</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PHOENIXD_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_phoenixd_password</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Rate Limits (optional)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HG_MAX_SMS_VERIFICATIONS_PER_WEEK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HG_MAX_SMS_VERIFICATIONS_PER_YEAR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Server</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HG_PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HG_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0.0.0</span></span></code></pre></figure>
<h3 id="running">Running<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#running" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="development">Development<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#development" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Clone repository</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/pubky/homegate</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homegate</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Set up environment</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Edit .env with your credentials</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run database migrations</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Start server</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span></span></code></pre></figure>
<h4 id="production">Production<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#production" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build release binary</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --release</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run migrations</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./target/release/homegate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Start service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./target/release/homegate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span></span></code></pre></figure>
<h4 id="docker">Docker<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#docker" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build image</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homegate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run with environment</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homegate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8080:8080</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --env-file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  homegate</span></span></code></pre></figure>
<h3 id="database-migrations">Database Migrations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#database-migrations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Homegate uses SQLx for database migrations:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run all pending migrations</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create new migration</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create_new_table</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Rollback last migration (if supported)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span></span></code></pre></figure>
<p>Migrations are located in <code>src/infrastructure/sql/migrations/</code>.</p>
<h3 id="critical-pepper-security">Critical: Pepper Security<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#critical-pepper-security" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>On first run, Homegate generates a <strong>pepper</strong> file at <code>/.homegate/pepper.txt</code>:</p>
<p><strong>⚠️ BACKUP THIS FILE</strong></p>
<p>If lost:</p>
<ul>
<li>Cannot match existing phone number hashes to new verification requests</li>
<li>Rate limits will not be enforced correctly</li>
<li>Existing verified users may be unable to re-verify</li>
</ul>
<p><strong>Security recommendations</strong>:</p>
<ul>
<li>Store pepper in encrypted backup</li>
<li>Restrict file permissions (<code>chmod 600</code>)</li>
<li>Include in disaster recovery plan</li>
<li>Never commit to version control</li>
</ul>
<h2 id="integration-with-homeservers">Integration with Homeservers<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#integration-with-homeservers" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Homegate is designed to integrate with <a href="../../Explore/PubkyCore/Homeserver" class="internal alias" data-slug="Explore/PubkyCore/Homeserver">Pubky Homeserver</a> signup flows:</p>
<h3 id="typical-integration">Typical Integration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#typical-integration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li><strong>User initiates signup</strong> on homeserver web interface</li>
<li><strong>Homeserver redirects</strong> to Homegate verification flow</li>
<li><strong>User completes verification</strong> (SMS or Lightning)</li>
<li><strong>Homegate returns success</strong> to homeserver</li>
<li><strong>Homeserver creates account</strong> using <a href="../../Explore/PubkyCore/SDK" class="internal alias" data-slug="Explore/PubkyCore/SDK">Pubky Core SDK</a></li>
</ol>
<h3 id="verification-token-flow">Verification Token Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#verification-token-flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>After successful verification, Homegate can issue a signed token:</p>
<ul>
<li>Homeserver verifies token signature</li>
<li>Token contains verification method, timestamp, rate limit info</li>
<li>Prevents verification bypass attacks</li>
</ul>
<h3 id="self-hosted-vs-shared">Self-Hosted vs. Shared<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#self-hosted-vs-shared" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Self-Hosted Homegate</strong>:</p>
<ul>
<li>Full control over verification policies</li>
<li>Custom rate limits</li>
<li>Private SMS/Lightning credentials</li>
<li>Isolated user base</li>
</ul>
<p><strong>Shared Homegate</strong>:</p>
<ul>
<li>Multiple homeservers share one Homegate instance</li>
<li>Centralized rate limiting across homeservers</li>
<li>Reduced operational overhead</li>
<li>Shared anti-spam database</li>
</ul>
<h2 id="testing">Testing<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#testing" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="unit-tests">Unit Tests<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#unit-tests" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Test individual components</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --lib</span></span></code></pre></figure>
<h3 id="integration-tests">Integration Tests<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#integration-tests" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Requires PostgreSQL</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATABASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres://postgres:postgres@localhost:5432/homegate_test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span></code></pre></figure>
<h3 id="e2e-http-tests">E2E HTTP Tests<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#e2e-http-tests" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Full HTTP integration tests with mocked SMS/Lightning</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATABASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres://postgres:postgres@localhost:5432/homegate_test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --lib</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> e2e::</span></span></code></pre></figure>
<p>Test structure:</p>
<ul>
<li><strong>Unit tests</strong>: IP extraction, hashing logic</li>
<li><strong>Service tests</strong>: Business logic, database operations</li>
<li><strong>E2E tests</strong>: Full HTTP flows with WireMock for external APIs</li>
</ul>
<h2 id="use-cases">Use Cases<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#use-cases" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="public-homeserver-operation">Public Homeserver Operation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#public-homeserver-operation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Run a public homeserver with spam protection:</p>
<ul>
<li>Require SMS verification for all signups</li>
<li>Rate limit accounts per phone number</li>
<li>Preserve user privacy with hashed identifiers</li>
</ul>
<h3 id="lightning-gated-community">Lightning-Gated Community<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lightning-gated-community" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Create a homeserver requiring payment for access:</p>
<ul>
<li>Set minimum Lightning payment amount</li>
<li>Immediate verification upon payment</li>
<li>No personal information required</li>
<li>Donations support homeserver operation</li>
</ul>
<h3 id="hybrid-verification">Hybrid Verification<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hybrid-verification" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Offer users a choice:</p>
<ul>
<li>SMS verification (free, but rate-limited)</li>
<li>Lightning payment (instant, any amount)</li>
<li>Different verification levels for different features</li>
</ul>
<h3 id="regional-homeserver">Regional Homeserver<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#regional-homeserver" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Operate a homeserver for specific region:</p>
<ul>
<li>SMS verification validates phone number locality</li>
<li>Rate limits prevent cross-border spam</li>
<li>Lightning fallback for international users</li>
</ul>
<h3 id="developmenttesting">Development/Testing<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#developmenttesting" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Run a homeserver for development:</p>
<ul>
<li>Low Lightning payment amounts (1 sat)</li>
<li>Relaxed SMS rate limits</li>
<li>Easy cleanup between test runs</li>
</ul>
<h2 id="operational-considerations">Operational Considerations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#operational-considerations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="costs">Costs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#costs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>SMS Verification</strong>:</p>
<ul>
<li>Prelude charges per SMS sent</li>
<li>Typical cost: $0.01-0.10 per SMS (varies by country)</li>
<li>Rate limits reduce cost exposure</li>
</ul>
<p><strong>Lightning Verification</strong>:</p>
<ul>
<li>PhoenixD requires Lightning node operation</li>
<li>Incoming payments incur routing fees (~1%)</li>
<li>Channel liquidity management</li>
<li>On-chain fees for channel opens/closes</li>
</ul>
<h3 id="reliability">Reliability<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#reliability" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>SMS Dependencies</strong>:</p>
<ul>
<li>Prelude API uptime</li>
<li>International SMS delivery reliability</li>
<li>Phone number portability issues</li>
</ul>
<p><strong>Lightning Dependencies</strong>:</p>
<ul>
<li>PhoenixD node uptime</li>
<li>Lightning Network routing reliability</li>
<li>Channel liquidity availability</li>
<li>WebSocket connection stability</li>
</ul>
<h3 id="scalability">Scalability<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#scalability" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Database</strong>:</p>
<ul>
<li>PostgreSQL handles millions of verifications</li>
<li>Index on phone number hashes for performance</li>
<li>Regular cleanup of expired verifications</li>
</ul>
<p><strong>SMS Service</strong>:</p>
<ul>
<li>Prelude scales automatically</li>
<li>Consider multiple SMS providers for redundancy</li>
</ul>
<p><strong>Lightning Service</strong>:</p>
<ul>
<li>PhoenixD requires channel capacity monitoring</li>
<li>Automated channel rebalancing recommended</li>
<li>Consider Lightning Service Provider (LSP) for larger scale</li>
</ul>
<h3 id="privacy">Privacy<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#privacy" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>SMS Verification</strong>:</p>
<ul>
<li>Phone numbers hashed before storage</li>
<li>Pepper protects against rainbow tables</li>
<li>Argon2id makes brute-force infeasible</li>
<li>No plaintext phone numbers in logs</li>
</ul>
<p><strong>Lightning Verification</strong>:</p>
<ul>
<li>No personal information collected</li>
<li>Payment amounts are visible on Lightning Network</li>
<li>Invoice descriptions should not contain PII</li>
<li>Payment hashes cannot be linked to users without invoices</li>
</ul>
<h2 id="security-considerations">Security Considerations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#security-considerations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="threat-model">Threat Model<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#threat-model" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Attacks Homegate Prevents</strong>:</p>
<ul>
<li>Bulk account creation via SMS farming</li>
<li>Phone number enumeration attacks</li>
<li>Verification code brute-forcing</li>
<li>Rate limit bypass attempts</li>
</ul>
<p><strong>Attacks Homegate Does NOT Prevent</strong>:</p>
<ul>
<li>Stolen phone numbers (SIM swapping)</li>
<li>Stolen Lightning payments (compromised wallets)</li>
<li>Sophisticated adversaries with large phone number pools</li>
<li>State-level phone number access</li>
</ul>
<h3 id="best-practices">Best Practices<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#best-practices" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li><strong>Rotate pepper periodically</strong> (with migration strategy)</li>
<li><strong>Monitor rate limit patterns</strong> for abuse</li>
<li><strong>Set up alerts</strong> for SMS/Lightning service failures</li>
<li><strong>Regular database backups</strong> including pepper file</li>
<li><strong>Rate limit per IP</strong> in addition to per phone number</li>
<li><strong>Log verification attempts</strong> for abuse analysis</li>
<li><strong>Use HTTPS</strong> for all API endpoints</li>
<li><strong>Validate all input</strong> (phone numbers, codes, amounts)</li>
</ol>
<h2 id="limitations">Limitations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#limitations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="phone-number-verification">Phone Number Verification<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#phone-number-verification" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>SMS delivery</strong>: Not guaranteed in all countries</li>
<li><strong>Phone number recycling</strong>: Old numbers may be reassigned</li>
<li><strong>VoIP numbers</strong>: May not receive SMS</li>
<li><strong>Rate limit bypass</strong>: Users with multiple phone numbers</li>
<li><strong>Cost</strong>: SMS fees add up for high-volume homeservers</li>
</ul>
<h3 id="lightning-network-verification-1">Lightning Network Verification<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lightning-network-verification-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>Technical barrier</strong>: Users need Lightning wallet</li>
<li><strong>Liquidity</strong>: Homeserver needs sufficient inbound liquidity</li>
<li><strong>Network fees</strong>: May exceed verification amount for small payments</li>
<li><strong>UX complexity</strong>: More steps than SMS for non-technical users</li>
<li><strong>Volatility</strong>: Sat amounts may need adjustment based on BTC price</li>
</ul>
<h3 id="general">General<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#general" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>Not a complete KYC solution</strong>: Verifies possession, not identity</li>
<li><strong>Privacy vs. abuse trade-off</strong>: Better privacy = easier to abuse</li>
<li><strong>Centralization risk</strong>: SMS provider is single point of failure</li>
<li><strong>Pepper loss</strong>: Unrecoverable without backups</li>
</ul>
<h2 id="future-enhancements">Future Enhancements<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#future-enhancements" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Potential improvements for Homegate:</p>
<ul>
<li><strong>Multiple SMS providers</strong>: Failover and redundancy</li>
<li><strong>CAPTCHA verification</strong>: Browser-based spam prevention</li>
<li><strong>Email verification</strong>: Additional verification method</li>
<li><strong>OAuth/OIDC</strong>: Social login as verification</li>
<li><strong>Reputation systems</strong>: Trust scores for verified users</li>
<li><strong>Geographic restrictions</strong>: Limit by country/region</li>
<li><strong>Time-based rate limits</strong>: Daily/hourly limits</li>
<li><strong>Payment-based rate limit increases</strong>: Pay more = higher limits</li>
<li><strong>Multi-factor verification</strong>: Require SMS + Lightning</li>
<li><strong>Verification marketplace</strong>: Allow third-party verifiers</li>
</ul>
<h2 id="resources">Resources<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#resources" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li><strong>Repository</strong>: <a href="https://github.com/pubky/homegate" class="external">https://github.com/pubky/homegate<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><strong>OpenAPI Spec</strong>: <a href="https://github.com/pubky/homegate/blob/main/openapi.yaml" class="external">openapi.yaml<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><strong>Prelude Documentation</strong>: <a href="https://docs.prelude.so/" class="external">https://docs.prelude.so/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><strong>PhoenixD Documentation</strong>: <a href="https://github.com/ACINQ/phoenixd" class="external">https://github.com/ACINQ/phoenixd<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
</ul>
<h2 id="see-also">See Also<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#see-also" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li><a href="../../Explore/PubkyCore/Homeserver" class="internal" data-slug="Explore/PubkyCore/Homeserver">Homeserver</a> - Pubky homeserver documentation</li>
<li><a href="../../Explore/PubkyCore/Introduction" class="internal alias" data-slug="Explore/PubkyCore/Introduction">Pubky Core</a> - Core protocol and SDK</li>
<li><a href="../../FAQ#q37" class="internal alias" data-slug="FAQ">Q37</a> - How users join Pubky App</li>
<li><a href="../../Explore/Concepts/Censorship" class="internal" data-slug="Explore/Concepts/Censorship">Censorship</a> - Censorship resistance principles</li>
</ul></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div style="overflow-y:auto;max-height:40vh;" class="toc desktop-only"><button type="button" id="toc" class><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#homegate-homeserver-signup-gatekeeping-service" data-for="homegate-homeserver-signup-gatekeeping-service">Homegate: Homeserver Signup Gatekeeping Service</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#overview" data-for="overview">Overview</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#use-case" data-for="use-case">Use Case</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#architecture" data-for="architecture">Architecture</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#components" data-for="components">Components</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#technology-stack" data-for="technology-stack">Technology Stack</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#verification-methods" data-for="verification-methods">Verification Methods</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#sms-verification" data-for="sms-verification">SMS Verification</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#lightning-network-verification" data-for="lightning-network-verification">Lightning Network Verification</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#api-reference" data-for="api-reference">API Reference</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#sms-verification-endpoints" data-for="sms-verification-endpoints">SMS Verification Endpoints</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#lightning-network-endpoints" data-for="lightning-network-endpoints">Lightning Network Endpoints</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#deployment" data-for="deployment">Deployment</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#prerequisites" data-for="prerequisites">Prerequisites</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#configuration" data-for="configuration">Configuration</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#running" data-for="running">Running</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#database-migrations" data-for="database-migrations">Database Migrations</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#critical-pepper-security" data-for="critical-pepper-security">Critical: Pepper Security</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#integration-with-homeservers" data-for="integration-with-homeservers">Integration with Homeservers</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#typical-integration" data-for="typical-integration">Typical Integration</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#verification-token-flow" data-for="verification-token-flow">Verification Token Flow</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#self-hosted-vs-shared" data-for="self-hosted-vs-shared">Self-Hosted vs. Shared</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#testing" data-for="testing">Testing</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#unit-tests" data-for="unit-tests">Unit Tests</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#integration-tests" data-for="integration-tests">Integration Tests</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#e2e-http-tests" data-for="e2e-http-tests">E2E HTTP Tests</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#use-cases" data-for="use-cases">Use Cases</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#public-homeserver-operation" data-for="public-homeserver-operation">Public Homeserver Operation</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#lightning-gated-community" data-for="lightning-gated-community">Lightning-Gated Community</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#hybrid-verification" data-for="hybrid-verification">Hybrid Verification</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#regional-homeserver" data-for="regional-homeserver">Regional Homeserver</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#developmenttesting" data-for="developmenttesting">Development/Testing</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#operational-considerations" data-for="operational-considerations">Operational Considerations</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#costs" data-for="costs">Costs</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#reliability" data-for="reliability">Reliability</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#scalability" data-for="scalability">Scalability</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#privacy" data-for="privacy">Privacy</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#security-considerations" data-for="security-considerations">Security Considerations</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#threat-model" data-for="threat-model">Threat Model</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#best-practices" data-for="best-practices">Best Practices</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#limitations" data-for="limitations">Limitations</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#phone-number-verification" data-for="phone-number-verification">Phone Number Verification</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#lightning-network-verification-1" data-for="lightning-network-verification-1">Lightning Network Verification</a></li><li class="depth-2"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#general" data-for="general">General</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#future-enhancements" data-for="future-enhancements">Future Enhancements</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#resources" data-for="resources">Resources</a></li><li class="depth-1"><a style="font-size:17px;line-height:22px;letter-spacing:0.4px;font-weight:600;" href="#see-also" data-for="see-also">See Also</a></li></ul></div></div></div></div><footer class><div style="border:none;border-top:0.1px solid white;width:100%;margin-top:100px;margin-bottom:35px;opacity:0.7;"></div><ul><li><a style="color:white;font-weight:400;font-size:17px;" href="https://synonym.to">Synonym</a></li><li><a style="color:white;font-weight:400;font-size:17px;" href="https://github.com/pubky/pubky-knowledge-base">GitHub</a></li><li><a style="color:white;font-weight:400;font-size:17px;" href="https://t.me/pubkychat">Telegram</a></li></ul></footer><div style="background-image:url('/static/bg.png');background-size:cover;background-position:center;pointer-events:none;position:fixed;top:0px;left:0px;right:0px;bottom:0px;width:100%;height:100%;z-index:-1;"></div><div style="background-image:url('/static/bg-2.png');background-size:cover;background-position:center;pointer-events:none;position:fixed;top:0px;left:0px;right:0px;bottom:0px;width:100%;height:100%;z-index:-1;"></div><div style="background-image:url('/static/bg-3.png');background-size:cover;background-position:left;background-repeat:no-repeat;position:fixed;pointer-events:none;right:0px;bottom:0px;width:100%;height:100%;max-height:20%;max-width:20%;z-index:0;"></div></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../../postscript.js" type="module"></script></html>